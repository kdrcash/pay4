<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>인건비 예측 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Apple SD Gothic Neo','Noto Sans KR', sans-serif; background:#f3f4f6}
    .card{background:#fff; border:1px solid #e5e7eb; border-radius:1rem;}
    .tbl{border-collapse:collapse; width:100%; font-size:14px}
    .tbl th,.tbl td{border:1px solid #e5e7eb; padding:8px 10px; text-align:right; white-space:nowrap}
    .tbl th{background:#f9fafb; text-align:center}
    .tone{background:#fffbcc}
    .lbl{color:#4b5563; font-weight:600}
    .input{width:100%; border:1px solid #d1d5db; border-radius:.5rem; padding:.5rem .75rem; text-align:right; outline:none}
    .input:focus{border-color:#2563eb; box-shadow:0 0 0 3px rgba(37,99,235,.2)}
    .hint{font-size:11px; color:#6b7280}
  </style>
</head>
<body class="p-4 sm:p-6 flex items-start justify-center min-h-screen">
  <main class="w-full max-w-[1280px] xl:max-w-[1400px] space-y-4">
    <section class="card p-5">
      <div class="flex items-center justify-between gap-3">
        <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-900">인건비 예측</h1>
        <button id="open_rules" class="text-blue-600 underline font-semibold">계산 규칙</button>
      </div>
      <p class="mt-2 text-sm text-gray-600">1. 기본급 및 식대를 입력 후 <b>계산</b> 버튼을 누르면 자동 계산됩니다. 2. 급여명세서 뿐 아니라 해당 세율구간과 <b>연간 결정세액</b>을 추정합니다. 3. 공제는 기본내역 기준이므로 결과는 보수적입니다.</p>
    </section>

    <!-- 입력 영역 -->
    <section class="card p-5">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="lbl block mb-1">기본급(월)</label>
          <input id="base_pay" type="text" inputmode="numeric" class="input" placeholder="예: 10,000,000">
        </div>
        <div>
          <label class="lbl block mb-1">식대(월, 비과세)</label>
          <input id="meal" type="text" inputmode="numeric" class="input" placeholder="예: 200,000">
          <p class="hint mt-1">식대는 과세대상에서 제외됩니다(한도 내 가정).</p>
        </div>
      </div>

      <details class="mt-3">
        <summary class="cursor-pointer text-sm text-gray-700">추가 입력(선택) — 수당/상여/기타/연장/퇴직금</summary>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-3">
          <div><label class="lbl block mb-1">수당(월)</label><input id="allowance" type="text" inputmode="numeric" class="input" value="0"></div>
          <div><label class="lbl block mb-1">상여금(월)</label><input id="bonus" type="text" inputmode="numeric" class="input" value="0"></div>
          <div><label class="lbl block mb-1">기타수당(월)</label><input id="etc" type="text" inputmode="numeric" class="input" value="0"></div>
          <div><label class="lbl block mb-1">연장수당(월)</label><input id="ot" type="text" inputmode="numeric" class="input" value="0"></div>
          <div><label class="lbl block mb-1">퇴직금(월 환산)</label><input id="retire" type="text" inputmode="numeric" class="input" value="0"></div>
        </div>
      </details>

      <div class="mt-4 flex items-center gap-2">
        <button id="calc_btn" class="px-4 py-2 rounded-lg bg-blue-600 text-white font-bold disabled:opacity-50 disabled:cursor-not-allowed" disabled>계산</button>
        <span id="table_status" class="hint">세액표 불러오는 중…</span>
      </div>
    </section>

    <!-- 결과 영역 -->
    <section id="result_card" class="card p-5 hidden">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
        <!-- 좌: 지급과 공제내역(월) -->
        <div class="lg:col-span-2">
          <h3 class="text-lg font-bold text-gray-800 mb-2">지급과 공제내역 (월)</h3>
          <div class="grid grid-cols-2 gap-4">
            <!-- 지급액 -->
            <div>
              <table class="tbl">
                <thead><tr><th colspan="2">지급액</th></tr></thead>
                <tbody>
                  <tr><td style="text-align:left">기본급</td><td id="p_base"></td></tr>
                  <tr><td style="text-align:left">식대</td><td id="p_meal"></td></tr>
                  <tr><td style="text-align:left">수당</td><td id="p_allow"></td></tr>
                  <tr><td style="text-align:left">상여금</td><td id="p_bonus"></td></tr>
                  <tr><td style="text-align:left">기타수당</td><td id="p_etc"></td></tr>
                  <tr><td style="text-align:left">연장수당</td><td id="p_ot"></td></tr>
                  <tr><td style="text-align:left">퇴직금</td><td id="p_retire"></td></tr>
                  <tr class="tone"><td style="text-align:left; font-weight:700">지급총액</td><td id="p_total" style="font-weight:700"></td></tr>
                </tbody>
              </table>
            </div>
            <!-- 공제액 -->
            <div>
              <table class="tbl">
                <thead><tr><th colspan="2">공제액</th></tr></thead>
                <tbody>
                  <tr><td style="text-align:left">국민연금</td><td id="d_np"></td></tr>
                  <tr><td style="text-align:left">건강보험</td><td id="d_hi"></td></tr>
                  <tr><td style="text-align:left">장기요양보험</td><td id="d_ltc"></td></tr>
                  <tr><td style="text-align:left">고용보험</td><td id="d_ei"></td></tr>
                  <tr><td style="text-align:left">소득세</td><td id="d_itx"></td></tr>
                  <tr><td style="text-align:left">주민세</td><td id="d_ltx"></td></tr>
                  <tr class="tone"><td style="text-align:left; font-weight:700">공제총액</td><td id="d_total" style="font-weight:700"></td></tr>
                  <tr class="tone"><td style="text-align:left; font-weight:800">실수령액</td><td id="net_take" style="font-weight:800"></td></tr>
                </tbody>
              </table>
            </div>
          </div>
          <p class="hint mt-2">※ 모든 세목·보험 10원 절사, 연금 기준소득 천원 내림, 식대는 과세 제외.</p>
        </div>

        <!-- 우: 세금계산내역(연) -->
        <div>
          <h3 class="text-lg font-bold text-gray-800 mb-2">세금계산내역 (연간)</h3>
          <table class="tbl">
            <thead><tr><th style="width:50%">구분</th><th>금액</th></tr></thead>
            <tbody>
              <tr><td style="text-align:left">총급여</td><td id="y_gross"></td></tr>
              <tr><td style="text-align:left">근로소득공제</td><td id="y_earn_ded"></td></tr>
              <tr><td style="text-align:left">근로소득금액</td><td id="y_earn_amt"></td></tr>
              <tr><td style="text-align:left">기본공제</td><td id="y_basic"></td></tr>
              <tr><td style="text-align:left">과세표준</td><td id="y_base"></td></tr>
              <tr><td style="text-align:left">세율</td><td id="y_rate"></td></tr>
              <tr><td style="text-align:left">산출세액</td><td id="y_calc"></td></tr>
              <tr><td style="text-align:left">근로소득세액공제</td><td id="y_credit_work"></td></tr>
              <tr><td style="text-align:left">표준세액공제</td><td id="y_credit_std"></td></tr>
              <tr class="tone"><td style="text-align:left; font-weight:700">결정세액</td><td id="y_final" style="font-weight:700"></td></tr>
              <tr><td style="text-align:left">기납부세액(월원천×12)</td><td id="y_paid"></td></tr>
              <tr class="tone"><td style="text-align:left; font-weight:800">차감징수세액</td><td id="y_due" style="font-weight:800"></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="card p-4 text-center">
      <footer class="text-xs text-gray-500">© 2025 한국병의원데이터. All Rights Reserved</footer>
    </section>
  </main>

  <!-- 규칙 모달 -->
  <div id="rules_modal" class="fixed inset-0 z-50 hidden items-center justify-center">
    <div class="absolute inset-0 bg-black/50"></div>
    <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-lg mx-4 p-6">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-lg font-bold text-gray-900">계산 규칙</h3>
        <button id="close_rules" class="p-2 -m-2 rounded-lg hover:bg-gray-100">✕</button>
      </div>
      <ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">
        <li>간이세액표(JSON, 1인) 로드</li>
        <li>국민연금 기준소득: <b>천원 내림</b> · <b>상·하한</b> 적용</li>
        <li>건강보험 보수월액: 상·하한 적용, 장기요양=건보×12.95%</li>
        <li>고용보험: 보수월액 기준</li>
        <li>모든 세목·보험: <b>10원 절사</b></li>
        <li>결정세액(연): <b>2025 누진세율·누진공제</b> 적용, 기본공제 1,500,000(1인) 가정</li>
      </ul>
      <div class="text-right mt-4">
        <button id="ok_rules" class="px-4 py-2 rounded-lg bg-blue-600 text-white">확인</button>
      </div>
    </div>
  </div>

  <script>
    /* ========= 유틸 ========= */
    const fmt = n => new Intl.NumberFormat('ko-KR').format(Math.round(n))+' 원';
    const onlyNum = s => parseFloat((s||'0').replace(/[^\d]/g,''))||0;
    const trunc10 = v => Math.floor(v/10)*10;
    const clamp = (x,lo,hi)=>Math.min(Math.max(x,lo),hi);
    const bindComma = el => el.addEventListener('input', e=>{
      const d = e.target.value.replace(/[^\d]/g,'');
      e.target.value = d ? new Intl.NumberFormat('ko-KR').format(+d) : '';
    });

    // 입력 바인딩
    ['base_pay','meal','allowance','bonus','etc','ot','retire'].forEach(id=>{
      const el=document.getElementById(id); if(el) bindComma(el);
    });

    // 규칙 모달
    const modal=document.getElementById('rules_modal');
    document.getElementById('open_rules').onclick=()=>{modal.classList.remove('hidden'); modal.classList.add('flex')};
    function closeModal(){modal.classList.add('hidden'); modal.classList.remove('flex')}
    document.getElementById('close_rules').onclick=closeModal;
    document.getElementById('ok_rules').onclick=closeModal;
    modal.addEventListener('click',e=>{const d=modal.querySelector('.relative'); if(!d.contains(e.target)) closeModal()});

    /* ========= 파라미터 ========= */
    // 4대보험(근로자)
    const NP_MIN=400_000, NP_MAX=6_370_000;
    const HI_MIN=279_266, HI_MAX=127_056_982;
    const NP_RATE=0.0450, HI_RATE=0.03545, LTC_RATE=0.1295, EI_RATE=0.0090;
    // 누적용(사업주 비용 필요시 확장 가능)

    // 간이세액표: 이 기준 미만이면 월 소득세 0(비과세 제외 보수월액)
    const TAX_ZERO_THRESHOLD=1_060_000;

    // 2025 누진세율·누진공제 (연)
    const BRACKETS_2025 = [
      { upTo: 12_000_000, rate: 0.06,  deduction:      0 },
      { upTo: 46_000_000, rate: 0.15,  deduction: 1_080_000 },
      { upTo: 88_000_000, rate: 0.24,  deduction: 5_220_000 },
      { upTo:150_000_000, rate: 0.35,  deduction:14_900_000 },
      { upTo:300_000_000, rate: 0.38,  deduction:19_400_000 },
      { upTo:500_000_000, rate: 0.40,  deduction:25_400_000 },
      { upTo:1_000_000_000, rate:0.42, deduction:35_400_000 },
      { upTo: Infinity,    rate:0.45, deduction:65_400_000 },
    ];

    // 근로소득공제(연) — 일반 구간식
    function earnedIncomeDeduction(g){
      let d=0;
      if (g <= 5_000_000) d = g*0.70;
      else if (g <= 15_000_000) d = 3_500_000 + (g-5_000_000)*0.40;
      else if (g <= 45_000_000) d = 7_500_000 + (g-15_000_000)*0.15;
      else if (g <= 100_000_000) d = 12_000_000 + (g-45_000_000)*0.10;
      else { d = 17_000_000 + (g-100_000_000)*0.05; d = Math.min(d, 20_000_000); }
      return Math.max(0, Math.floor(d));
    }
    function progressiveTaxAnnual(taxBase){
      const b=BRACKETS_2025.find(br=>taxBase<=br.upTo)||BRACKETS_2025.at(-1);
      const tax = Math.max(0, Math.floor(taxBase*b.rate - b.deduction + 0.5));
      return {tax, rate:b.rate, deduction:b.deduction};
    }

    /* ========= 간이세액표 로드 ========= */
    let TAX_TABLE=[], tableReady=false;
    async function loadTable(){
      const status=document.getElementById('table_status');
      async function fetchJson(p){ const r=await fetch(p,{cache:'no-store'}); if(!r.ok) throw new Error(r.status); return r.json(); }
      try{
        try{ TAX_TABLE = await fetchJson('./simplified_tax_table_2024_1person.v2.json'); }
        catch{ TAX_TABLE = await fetchJson('./simplified_tax_table_2024_1person.json'); }
        TAX_TABLE.sort((a,b)=>a.min_won-b.min_won);
        tableReady=true; status.textContent='세액표 로드 완료';
        document.getElementById('calc_btn').disabled=false;
      }catch(e){
        status.textContent='세액표 로드 실패: '+e.message;
      }
    }
    loadTable();

    function lookupTax(amount){
      // amount: 비과세 제외 보수월액
      let lo=0, hi=TAX_TABLE.length-1;
      while(lo<=hi){
        const m=(lo+hi)>>1, row=TAX_TABLE[m];
        if(amount<row.min_won) hi=m-1; else if(amount>=row.max_won) lo=m+1;
        else return trunc10(+row.tax||0);
      }
      return 0;
    }

    /* ========= 계산 ========= */
    document.getElementById('calc_btn').addEventListener('click', ()=>{
      if(!tableReady) return;

      const base  = onlyNum(document.getElementById('base_pay').value);
      const meal  = onlyNum(document.getElementById('meal').value);
      const allow = onlyNum(document.getElementById('allowance').value);
      const bonus = onlyNum(document.getElementById('bonus').value);
      const etc   = onlyNum(document.getElementById('etc').value);
      const ot    = onlyNum(document.getElementById('ot').value);
      const retire= onlyNum(document.getElementById('retire').value);

      const payTotal = base + meal + allow + bonus + etc + ot + retire;

      // 보수월액(과세 기준) = 총지급 - 비과세(식대)
      const baseInsRaw = Math.max(payTotal - meal, 0);
      const npBase = clamp(Math.floor(baseInsRaw/1000)*1000, NP_MIN, NP_MAX);
      const hiBase = clamp(baseInsRaw, HI_MIN, HI_MAX);
      const eiBase = baseInsRaw;

      // 4대보험(근로자)
      const np  = trunc10(npBase*NP_RATE);
      const hi  = trunc10(hiBase*HI_RATE);
      const ltc = trunc10(hi*LTC_RATE);
      const ei  = trunc10(eiBase*EI_RATE);

      // 간이세액(월)
      const itx = baseInsRaw < TAX_ZERO_THRESHOLD ? 0 : lookupTax(baseInsRaw);
      const ltx = baseInsRaw < TAX_ZERO_THRESHOLD ? 0 : trunc10(itx*0.10);

      const dedTotal = np+hi+ltc+ei+itx+ltx;
      const net = payTotal - dedTotal;

      // 좌측 표 반영
      document.getElementById('p_base').textContent   = fmt(base);
      document.getElementById('p_meal').textContent   = fmt(meal);
      document.getElementById('p_allow').textContent  = fmt(allow);
      document.getElementById('p_bonus').textContent  = fmt(bonus);
      document.getElementById('p_etc').textContent    = fmt(etc);
      document.getElementById('p_ot').textContent     = fmt(ot);
      document.getElementById('p_retire').textContent = fmt(retire);
      document.getElementById('p_total').textContent  = fmt(payTotal);

      document.getElementById('d_np').textContent  = fmt(np);
      document.getElementById('d_hi').textContent  = fmt(hi);
      document.getElementById('d_ltc').textContent = fmt(ltc);
      document.getElementById('d_ei').textContent  = fmt(ei);
      document.getElementById('d_itx').textContent = fmt(itx);
      document.getElementById('d_ltx').textContent = fmt(ltx);
      document.getElementById('d_total').textContent=fmt(dedTotal);
      document.getElementById('net_take').textContent=fmt(net);

      // 우측(연간) — 총급여는 월 총지급×12
      const annualGross = payTotal*12;
      const earnDed = earnedIncomeDeduction(annualGross);
      const earnAmt = Math.max(0, annualGross - earnDed);
      const basic = 1_500_000; // 1인 기본공제 가정
      const taxBase = Math.max(0, earnAmt - basic);
      const {tax:calcTax, rate:mr, deduction:nd} = progressiveTaxAnnual(taxBase);

      // 보수적 가정의 세액공제
      const creditWork = Math.min(740_000, Math.floor(calcTax*0.55));
      const creditStd = 130_000;
      const finalTax = Math.max(0, calcTax - creditWork - creditStd);

      const prePaid = (itx+ltx)*12; // 월 원천세 × 12
      const toPay = Math.max(0, finalTax - prePaid);

      document.getElementById('y_gross').textContent = fmt(annualGross);
      document.getElementById('y_earn_ded').textContent = fmt(earnDed);
      document.getElementById('y_earn_amt').textContent = fmt(earnAmt);
      document.getElementById('y_basic').textContent = fmt(basic);
      document.getElementById('y_base').textContent = fmt(taxBase);
      document.getElementById('y_rate').textContent = Math.round(mr*100)+'%';
      document.getElementById('y_calc').textContent = fmt(calcTax);
      document.getElementById('y_credit_work').textContent = fmt(creditWork);
      document.getElementById('y_credit_std').textContent = fmt(creditStd);
      document.getElementById('y_final').textContent = fmt(finalTax);
      document.getElementById('y_paid').textContent = fmt(prePaid);
      document.getElementById('y_due').textContent = fmt(toPay);

      document.getElementById('result_card').classList.remove('hidden');
    });
  </script>
</body>
</html>
