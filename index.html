<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë„¤íŠ¸ê¸‰ì—¬ ê³„ì‚°ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; background:#f3f4f6 }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:1rem; }
    .tone { background:#fef9c3 }

    .tnum { font-variant-numeric: tabular-nums; font-feature-settings: "tnum"; }
    .nowrap { white-space: nowrap; }
    #annual_table td.num, #annual_table th.num { text-align: right; }

    @media (max-width: 640px){
      #annual_table th, #annual_table td { padding: 6px 8px; }
    }

    .modal { position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50 }
    .modal.show { display:flex }
  </style>
</head>
<body class="p-4 sm:p-6 flex items-center justify-center min-h-screen">

  <main class="w-full max-w-[1280px] xl:max-w-[1400px]">
    <section class="card p-5 sm:p-7 mb-4">
      <div class="flex items-center justify-between gap-3">
        <h1 class="text-3xl sm:text-[2rem] font-extrabold leading-tight text-gray-900">ë„¤íŠ¸ê¸‰ì—¬ ê³„ì‚°ê¸°</h1>
        <div class="flex items-center gap-3">
          <button id="input_mode_open" type="button" class="px-2.5 py-1.5 rounded-md border border-blue-300 bg-blue-50 text-blue-700 text-sm hover:bg-blue-100" aria-haspopup="dialog" aria-controls="input_mode_modal">
            ì…ë ¥ ê¸°ì¤€: <b id="input_mode_label">ì‹¤ìˆ˜ë ¹</b>
          </button>
          <button id="ver_btn" type="button" class="text-blue-600 font-semibold hover:text-blue-800 underline">Ver 2.0</button>
        </div>
      </div>
    </section>

    <!-- ìƒë‹¨ ë°°ë„ˆ -->
    <div class="px-4 sm:px-5 mb-5">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <a href="https://www.kdrcash.kr/" target="_blank" rel="noopener noreferrer" class="block group">
          <div class="relative w-full aspect-[4/1] rounded-xl overflow-hidden border border-gray-200 shadow-sm">
            <img src="https://github.com/kdrcash/pay/blob/main/%EB%B3%91%EC%9D%98%EC%9B%90%20%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B6%84%EC%84%9D%20%ED%94%8C%EB%9E%AB%ED%8F%BC%20%EB%8B%A5%ED%84%B0%EC%BA%90%EC%8B%9C.png?raw=true" alt class="absolute inset-0 w-full h-full object-cover transition duration-200 group-hover:opacity-90">
          </div>
        </a>
        <a href="https://www.kdrcash.kr/" target="_blank" rel="noopener noreferrer" class="block group">
          <div class="relative w-full aspect-[4/1] rounded-xl overflow-hidden border border-gray-200 shadow-sm">
            <img src="https://github.com/kdrcash/pay/blob/main/%EB%B3%91%EC%9D%98%EC%9B%90%20%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B6%84%EC%84%9D%20%ED%94%8C%EB%9E%AB%ED%8F%BC%20%EB%8B%A5%ED%84%B0%EC%BA%90%EC%8B%9C.png?raw=true" alt class="absolute inset-0 w-full h-full object-cover transition duration-200 group-hover:opacity-90">
          </div>
        </a>
        <a href="https://www.kdrcash.kr/download" target="_blank" rel="noopener noreferrer" class="block group">
          <div class="relative w-full aspect-[4/1] rounded-xl overflow-hidden border border-gray-200 shadow-sm">
            <img src="https://github.com/kdrcash/pay/blob/main/%EB%8B%A5%ED%84%B0%EC%BA%90%EC%8B%9C%20%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C.png?raw=true" alt class="absolute inset-0 w-full h-full object-cover transition duration-200 group-hover:opacity-90">
          </div>
        </a>
        <a href="https://www.kdrcash.kr/survey" target="_blank" rel="noopener noreferrer" class="block group">
          <div class="relative w-full aspect-[4/1] rounded-xl overflow-hidden border border-gray-200 shadow-sm">
            <img src="https://github.com/kdrcash/pay/blob/main/%EA%B0%9C%EC%9B%90%EA%B4%80%EB%A0%A8%20%ED%95%84%EC%88%98%EC%9E%90%EB%A3%8C%20%EB%AA%A8%EC%9D%8C.png?raw=true" alt class="absolute inset-0 w-full h-full object-cover transition duration-200 group-hover:opacity-90">
          </div>
        </a>
      </div>
    </div>

    <section class="card p-6">
      <div class="flex items-center justify-center gap-4 mb-4 border-b pb-2">
        <button id="tab_single" type="button" class="px-4 py-2 text-sm font-semibold border-b-2 text-blue-600 font-bold border-blue-600">ë‹¨ì¼</button>
        <button id="tab_multi"  type="button" class="px-4 py-2 text-sm font-semibold border-b-2 text-gray-500 border-transparent">ë‹¤ì¤‘</button>
        <span class="ml-auto text-xs text-gray-500"></span>
      </div>

      <!-- ë‹¨ì¼ -->
      <div id="content_single">
        <div class="bg-white rounded-2xl p-6 md:p-8 border">
          <!-- ì…ë ¥ -->
          <div class="mb-3">
            <label id="primary_input_label" for="net_pay" class="block text-gray-700 font-semibold mb-2">ì‹¤ìˆ˜ë ¹ì•¡ (ì›)</label>
            <input id="net_pay" type="text" inputmode="numeric" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="ì˜ˆ: 11,350,000">
          </div>
          <div class="mb-4">
            <label for="nontax" class="block text-gray-700 font-semibold mb-2">ë¹„ê³¼ì„¸ í•©ê³„ (ì›”) : ì‹ëŒ€/ìê°€ìš´ì „ ë“± (ì›)</label>
            <input id="nontax" type="text" inputmode="numeric" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="ì˜ˆ: 200,000 (ì—†ìœ¼ë©´ 0)">
            <p id="table_status" class="text-[11px] text-gray-400 mt-1">ì„¸ì•¡í‘œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</p>
          </div>
          <button id="calc_btn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50" disabled>ê³„ì‚°í•˜ê¸°</button>

          <!-- ê²°ê³¼ -->
          <div id="result" class="bg-gray-50 rounded-lg p-6 hidden">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ê³„ì‚° ê²°ê³¼</h2>

            <!-- ì§€ê¸‰ì´ì•¡ / ê³µì œì•¡ í•©ê³„ -->
            <div class="grid grid-cols-2 gap-2 text-sm">
              <div class="bg-white rounded-lg border p-3">
                <div class="text-gray-600">ì§€ê¸‰ì´ì•¡</div>
                <div id="gross_pay_result" class="font-semibold text-gray-900 mt-1"></div>
              </div>
              <div class="bg-white rounded-lg border p-3">
                <div class="text-gray-600">ê³µì œì•¡ í•©ê³„</div>
                <div id="deductions_total_result" class="font-semibold text-gray-900 mt-1"></div>
              </div>
            </div>

            <!-- ì—°ë´‰ ì¹´ë“œ -->
            <div class="mt-4 grid grid-cols-2 gap-2 text-sm">
              <div class="bg-white rounded-lg border p-3">
                <div class="text-gray-700 font-medium">ì—°ë´‰(í‡´ì§ê¸ˆ ì œì™¸)</div>
                <div id="annual_excl" class="font-semibold text-gray-900 mt-1"></div>
                <div class="text-[11px] text-gray-500 mt-1">(= ì§€ê¸‰ì´ì•¡ Ã— 12)</div>
              </div>
              <div class="bg-white rounded-lg border p-3">
                <div class="text-gray-700 font-medium">ì—°ë´‰(í‡´ì§ê¸ˆ í¬í•¨)</div>
                <div id="annual_incl" class="font-semibold text-gray-900 mt-1"></div>
                <div class="text-[11px] text-gray-500 mt-1">(= ì§€ê¸‰ì´ì•¡ Ã— 13)</div>
              </div>
            </div>

            <!-- ì´ë¶€ë‹´ì•¡ ì¹´ë“œ + % -->
            <div class="mt-4 grid grid-cols-2 gap-2 text-sm">
              <div class="bg-white rounded-lg border p-3">
                <div class="text-gray-700 font-medium">ì´ë¶€ë‹´ì•¡(í‡´ì§ê¸ˆ ì œì™¸)</div>
                <div id="total_burden_excl" class="font-semibold text-gray-900 mt-1"></div>
                <div class="text-[11px] text-gray-500 mt-1">ì‹¤ìˆ˜ë ¹ì•¡ ëŒ€ë¹„ <span id="total_burden_excl_pct"></span></div>
              </div>
              <div class="bg-white rounded-lg border p-3">
                <div class="text-gray-700 font-medium">ì´ë¶€ë‹´ì•¡(í‡´ì§ê¸ˆ í¬í•¨)</div>
                <div id="total_burden_incl" class="font-semibold text-gray-900 mt-1"></div>
                <div class="text-[11px] text-gray-500 mt-1">ì‹¤ìˆ˜ë ¹ì•¡ ëŒ€ë¹„ <span id="total_burden_incl_pct"></span></div>
              </div>
            </div>

            <!-- ìš”ì•½ -->
            <div class="mt-6 space-y-1 text-sm">
              <div class="flex justify-between"><span class="text-gray-700">+ 4ëŒ€ë³´í—˜ ì´ì•¡(ê·¼ë¡œì+ì‚¬ì—…ì£¼)</span><span id="social_total_summary" class="font-semibold text-gray-900"></span></div>
              <div class="flex justify-between"><span class="text-gray-700">+ ì›ì²œì„¸ ì´ì•¡(ì†Œë“ì„¸+ì§€ë°©ì†Œë“ì„¸)</span><span id="withholding_total_summary" class="font-semibold text-gray-900"></span></div>
              <div class="border-t border-gray-300 my-1"></div>
              <div class="flex justify-between"><span class="text-gray-700">= ë¶€ëŒ€ë¹„ìš© ì´ì•¡(í‡´ì§ê¸ˆ ì œì™¸)</span><span id="overhead_excl_gratuity" class="font-semibold text-gray-900"></span></div>
              <div class="flex justify-between"><span class="text-gray-700">+ í‡´ì§ê¸ˆ (ì§€ê¸‰ì´ì•¡ì˜ 1/12)</span><span id="gratuity_summary" class="font-semibold text-gray-900"></span></div>
              <div class="border-t border-gray-300 my-1"></div>
              <div class="flex justify-between"><span class="text-gray-700">= ë¶€ëŒ€ë¹„ìš© ì´ì•¡(í‡´ì§ê¸ˆ í¬í•¨)</span><span id="overhead_incl_gratuity" class="font-semibold text-gray-900"></span></div>
            </div>

            <!-- ê³µì œ ì„¸ë¶€ -->
            <div class="mt-6">
              <h3 class="text-lg font-bold text-gray-700 mb-2">ì„¸ë¶€ ê³µì œ ë‚´ì—­</h3>
              <ul class="text-sm text-gray-600 space-y-1">
                <li class="flex justify-between"><span>êµ­ë¯¼ì—°ê¸ˆ (4.5%)</span><span id="np_deduction"></span></li>
                <li class="flex justify-between"><span>ê±´ê°•ë³´í—˜ (3.545%)</span><span id="hi_deduction"></span></li>
                <li class="flex justify-between"><span>ì¥ê¸°ìš”ì–‘ (ê±´ë³´ë£Œì˜ 12.95%)</span><span id="ltc_deduction"></span></li>
                <li class="flex justify-between"><span>ê³ ìš©ë³´í—˜ (0.9%)</span><span id="ei_deduction"></span></li>
                <li class="flex justify-between"><span>ì†Œë“ì„¸ (ê°„ì´ì„¸ì•¡í‘œ)</span><span id="tax_deduction"></span></li>
                <li class="flex justify-between"><span>ì§€ë°©ì†Œë“ì„¸ (10%)</span><span id="local_tax_deduction"></span></li>
              </ul>

              <!-- ì‚¬ì—…ì£¼ ë¶€ë‹´ -->
              <div class="mt-6 border-t pt-4">
                <h4 class="text-base font-bold text-gray-700 mb-2">ì‚¬ì—…ì£¼ ë¶€ë‹´ë¶„</h4>
                <ul class="text-sm text-gray-600 space-y-1">
                  <li class="flex justify-between"><span>êµ­ë¯¼ì—°ê¸ˆ (4.5%)</span><span id="np_er"></span></li>
                  <li class="flex justify-between"><span>ê±´ê°•ë³´í—˜ (3.545%)</span><span id="hi_er"></span></li>
                  <li class="flex justify-between"><span>ì¥ê¸°ìš”ì–‘ (ê±´ë³´ë£Œì˜ 12.95%)</span><span id="ltc_er"></span></li>
                  <li class="flex justify-between"><span>ê³ ìš©ë³´í—˜ (1.15%)</span><span id="ei_er"></span></li>
                  <li class="flex justify-between"><span>ì‚°ì¬ë³´í—˜ (0.72%)</span><span id="wci_er"></span></li>
                  <li class="flex justify-between font-semibold pt-1"><span>4ëŒ€ë³´í—˜ ì‚¬ì—…ì£¼ ë¶€ë‹´ë¶„</span><span id="er_total"></span></li>
                </ul>

                <details class="mt-4 text-[11px] text-gray-500">
                  <summary class="cursor-pointer">ê¸°ì¤€ ê¸ˆì•¡(ë³´ìˆ˜ì›”ì•¡/ì„¸ì•¡í‘œ ê¸°ì¤€) ë³´ê¸°</summary>
                  <div class="mt-2 space-y-1">
                    <div class="flex justify-between"><span>ë³´ìˆ˜ì›”ì•¡(ë¹„ê³¼ì„¸ ì œì™¸)</span><span id="base_ins"></span></div>
                    <div class="flex justify-between"><span>êµ­ë¯¼ì—°ê¸ˆ ê¸°ì¤€ì†Œë“(ì²œì›ë‹¨ìœ„Â·ìƒÂ·í•˜í•œ)</span><span id="base_np"></span></div>
                    <div class="flex justify-between"><span>ê±´ê°•ë³´í—˜ ì‚°ì •ê¸°ì¤€(ìƒÂ·í•˜í•œ)</span><span id="base_hi"></span></div>
                    <div class="flex justify-between"><span>ê³ ìš©ë³´í—˜ ì‚°ì •ê¸°ì¤€</span><span id="base_ei"></span></div>
                    <div class="flex justify-between"><span>ê°„ì´ì„¸ì•¡í‘œ ê¸°ì¤€ê¸ˆì•¡</span><span id="base_tax"></span></div>
                  </div>
                </details>
              </div>
            </div>

            <!-- ì—°ê°„: ìš”ì•½/ì „ì²´ í† ê¸€ -->
            <div class="mt-8">
              <div class="flex items-center justify-between gap-2 mb-1">
                <h3 class="text-lg font-bold text-gray-800">ì„¸ê¸ˆê³„ì‚°ë‚´ì—­ (ì—°ê°„)</h3>
                <button id="annual_toggle"
                        class="text-xs px-2 py-1 rounded-md border text-gray-700 hover:bg-gray-100"
                        type="button" aria-pressed="false">
                  ì „ì²´ ë³´ê¸°
                </button>
              </div>
              <p class="text-[11px] text-gray-500 mb-2">
                ì´ê¸‰ì—¬(ì—°) = (ì›” ì§€ê¸‰ì´ì•¡ âˆ’ ì›” ë¹„ê³¼ì„¸) Ã— 12 Â· í‘œì˜ â€˜ê¸°ë‚©ë¶€ì„¸ì•¡/ì°¨ê°ì§•ìˆ˜ì„¸ì•¡â€™ì€ ì†Œë“ì„¸ë§Œ ë°˜ì˜í•©ë‹ˆë‹¤.
              </p>
              <div id="annual_wrapper" class="rounded-lg border border-gray-200 overflow-x-hidden">
                <table id="annual_table" class="w-full text-xs sm:text-sm">
                  <thead class="bg-gray-50 text-gray-700">
                    <tr>
                      <th class="p-1.5 sm:p-2 border-b text-left">êµ¬ë¶„</th>
                      <th class="p-1.5 sm:p-2 border-b text-right num tnum">ê¸ˆì•¡</th>
                    </tr>
                  </thead>
                  <tbody id="annual_tax_detail" class="bg-white text-gray-800"></tbody>
                </table>
              </div>
            </div>

          </div>

          <div id="error_message" class="text-center text-red-500 mt-4 hidden">ìœ íš¨í•œ ê¸ˆì•¡ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.</div>
        </div>
      </div>

      <!-- ë‹¤ì¤‘ ì»¨í…ì¸  -->
      <div id="content_multi" class="hidden">
        <div class="bg-white rounded-2xl p-6 md:p-8 border">
          <div class="flex items-center justify-between mb-3">
            <div class="text-sm text-gray-600">ì—¬ëŸ¬ ê°œì˜ <span id="multi_hint_label">ì‹¤ìˆ˜ë ¹ì•¡ Â· ì§€ê¸‰ì´ì•¡(ì…ë ¥ ê¸°ì¤€ì— ë”°ë¦„)</span> & ë¹„ê³¼ì„¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì—¬ ìš”ì•½ ê²°ê³¼ë¥¼ í•œ ë²ˆì— í™•ì¸í•˜ì„¸ìš”.</div>
            <div class="flex gap-2">
              <!-- ë²„íŠ¼ì¤„ -->
              <button id="add_row" class="px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700">+ í–‰ ì¶”ê°€</button>
              <button id="reset_multi" class="px-3 py-2 text-sm bg-gray-200 text-white rounded-lg hover:bg-gray-700">ì´ˆê¸°í™”</button>
              <button id="calc_multi" class="px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700">ë‹¤ì¤‘ ê³„ì‚°</button>
            </div>
          </div>

          <div id="multi_inputs" class="space-y-2"></div>

          <!-- PCì—ì„œë„ ê°€ë¡œ ìŠ¤í¬ë¡¤ ìœ ì§€ -->
          <div class="overflow-x-auto mt-4">
            <table class="w-full text-sm border border-gray-200 rounded-lg overflow-hidden min-w-[1400px]">
              <thead class="bg-gray-50 text-gray-700">
                <tr>
                  <th id="th_multi_col1" class="p-2 border-b text-right whitespace-nowrap">ì‹¤ìˆ˜ë ¹ì•¡</th>
                  <th class="p-2 border-b text-right whitespace-nowrap">ë¹„ê³¼ì„¸</th>
                  <th class="p-2 border-b text-right whitespace-nowrap">ì§€ê¸‰ì´ì•¡</th>
                  <th class="p-2 border-b text-right whitespace-nowrap">ê³µì œí•©ê³„</th>
                  <th class="p-2 border-b text-right whitespace-nowrap">ì—°ë´‰ <span class="text-xs text-gray-500">(í‡´ì§ê¸ˆì œì™¸)</span></th>
                  <th class="p-2 border-b text-right whitespace-nowrap">ì—°ë´‰ <span class="text-xs text-gray-500">(í‡´ì§ê¸ˆí¬í•¨)</span></th>
                  <th class="p-2 border-b text-right whitespace-nowrap">ì´ë¶€ë‹´ <span class="text-xs text-gray-500">(í‡´ì§ê¸ˆì œì™¸)</span></th>
                  <th class="p-2 border-b text-right whitespace-nowrap">ì´ë¶€ë‹´% <span class="text-xs text-gray-500">(ì œì™¸)</span></th>
                  <th class="p-2 border-b text-right whitespace-nowrap">ì´ë¶€ë‹´ <span class="text-xs text-gray-500">(í‡´ì§ê¸ˆí¬í•¨)</span></th>
                  <th class="p-2 border-b text-right whitespace-nowrap">ì´ë¶€ë‹´% <span class="text-xs text-gray-500">(í¬í•¨)</span></th>
                  <th class="p-2 border-b text-right whitespace-nowrap">ê·¼ë¡œì†Œë“ê¸ˆì•¡</th>
                  <th class="p-2 border-b text-right whitespace-nowrap tnum">ì„¸ìœ¨êµ¬ê°„</th>
                  <th class="p-2 border-b text-right whitespace-nowrap">ê²°ì •ì„¸ì•¡</th>
                </tr>
              </thead>
              <tbody id="multi_results" class="text-gray-800"></tbody>
            </table>
          </div>

          <p id="table_status_multi" class="text-[11px] text-gray-400 mt-2">ì„¸ì•¡í‘œ ì¤€ë¹„ ìƒíƒœ: ë¡œë”© ì¤‘â€¦</p>
        </div>
      </div>
    </section>

    <!-- í•˜ë‹¨ ë°°ë„ˆ/í‘¸í„° -->
    <div class="px-4 sm:px-5 my-5">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <a href="https://www.kdrcash.kr/download" target="_blank" rel="noopener noreferrer" class="block group">
          <div class="relative w-full aspect-[4/1] rounded-xl overflow-hidden border border-gray-200 shadow-sm">
            <img src="https://github.com/kdrcash/pay/blob/main/%EB%8B%A5%ED%84%B0%EC%BA%90%EC%8B%9C%20%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C.png?raw=true" alt class="absolute inset-0 w-full h-full object-cover transition duration-200 group-hover:opacity-90">
          </div>
        </a>
        <a href="https://www.kdrcash.kr/survey" target="_blank" rel="noopener noreferrer" class="block group">
          <div class="relative w-full aspect-[4/1] rounded-xl overflow-hidden border border-gray-200 shadow-sm">
            <img src="https://github.com/kdrcash/pay/blob/main/%EA%B0%9C%EC%9B%90%EA%B4%80%EB%A0%A8%20%ED%95%84%EC%88%98%EC%9E%90%EB%A3%8C%20%EB%AA%A8%EC%9D%8C.png?raw=true" alt class="absolute inset-0 w-full h-full object-cover transition duration-200 group-hover:opacity-90">
          </div>
        </a>
      </div>
    </div>

    <section class="card p-4 text-center mt-4">
      <footer class="text-xs text-gray-500">Â© 2024 í•œêµ­ë³‘ì˜ì›ë°ì´í„°. All Rights Reserved</footer>
    </section>
  </main>

  <!-- Ver 2.0 ê·œì¹™ ëª¨ë‹¬ -->
  <div id="ver_modal" class="fixed inset-0 z-50 hidden items-center justify-center">
    <div class="absolute inset-0 bg-black/50"></div>
    <div role="dialog" aria-modal="true" class="relative w-full max-w-md mx-4 bg-white rounded-2xl shadow-2xl p-6">
      <div class="flex items-start justify-between mb-3">
        <h3 class="text-lg font-bold text-gray-800">ë²„ì „ 2.0 â€¢ ê³„ì‚° ê·œì¹™</h3>
        <button id="ver_close" class="p-2 -m-2 rounded-lg hover:bg-gray-100 focus:ring-2 focus:ring-blue-500" aria-label="ë‹«ê¸°">âœ•</button>
      </div>
      <div class="text-sm text-gray-700 space-y-4">
        <div>
          <h4 class="font-semibold text-gray-900 mb-1">ì ìš© ê·œì¹™</h4>
          <ul class="list-disc pl-5 space-y-1">
            <li>2024 ê°„ì´ì„¸ì•¡í‘œ(1ì¸) ì ìš©</li>
            <li>4ëŒ€ë³´í—˜ ìƒÂ·í•˜í•œ ë°˜ì˜</li>
            <li>ì¥ê¸°ìš”ì–‘ë³´í—˜ë£Œ = ê±´ê°•ë³´í—˜ë£Œ Ã— <b>12.95%</b></li>
            <li>ëª¨ë“  ì„¸ëª©Â·ë³´í—˜ <b>10ì› ì ˆì‚¬</b></li>
            <li>ì„¸ëª©Â·ë³´í—˜ ì‚°ì • ê¸°ì¤€: <b>ë¹„ê³¼ì„¸ ì œì™¸ ê¸ˆì•¡</b></li>
            <li>êµ­ë¯¼ì—°ê¸ˆ ê¸°ì¤€ì†Œë“: <b>ì²œì›ë‹¨ìœ„</b>ë¡œ ë‚´ë¦¼</li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-900 mb-2">ìƒÂ·í•˜í•œ | ë©´ì„¸ ê¸°ì¤€</h4>
          <div class="rounded-lg bg-gray-50 border border-gray-200 p-3 space-y-1 text=[13px]">
            <div class="flex justify-between"><span>êµ­ë¯¼ì—°ê¸ˆ ê¸°ì¤€ì†Œë“ì›”ì•¡ í•˜í•œ</span><span id="np_min_label"></span></div>
            <div class="flex justify-between"><span>êµ­ë¯¼ì—°ê¸ˆ ê¸°ì¤€ì†Œë“ì›”ì•¡ ìƒí•œ</span><span id="np_max_label"></span></div>
            <div class="flex justify-between"><span>ê±´ê°•ë³´í—˜ ë³´ìˆ˜ì›”ì•¡ í•˜í•œ</span><span id="hi_min_label"></span></div>
            <div class="flex justify-between"><span>ê±´ê°•ë³´í—˜ ë³´ìˆ˜ì›”ì•¡ ìƒí•œ</span><span id="hi_max_label"></span></div>
            <div class="flex justify-between font-semibold"><span>ì†Œë“ì„¸ ë©´ì„¸ ê¸°ì¤€</span><span id="tax_zero_label"></span></div>
          </div>
        </div>
      </div>
      <div class="mt-5 flex justify-end">
        <button id="ver_ok" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700">í™•ì¸</button>
      </div>
    </div>
  </div>

  <!-- ì…ë ¥ ê¸°ì¤€ ëª¨ë‹¬ (ì‹¤ìˆ˜ë ¹/ì§€ê¸‰ì´ì•¡) -->
  <div id="input_mode_modal" class="modal" aria-hidden="true">
    <div class="absolute inset-0 bg-black/50"></div>
    <div role="dialog" aria-modal="true" class="relative w-full max-w-md mx-4 bg-white rounded-2xl shadow-2xl p-6">
      <div class="flex items-start justify-between mb-3">
        <h3 class="text-lg font-bold text-gray-900">ì…ë ¥ ê¸°ì¤€ ì„ íƒ</h3>
        <button id="input_mode_close" class="p-2 -m-2 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="ë‹«ê¸°">âœ•</button>
      </div>

      <div class="space-y-3 text-sm">
        <label class="flex items-start gap-3 p-3 rounded-xl border cursor-pointer hover:bg-gray-50">
          <input type="radio" name="input_mode" value="net" class="mt-1.5" checked>
          <div class="flex-1">
            <div class="font-semibold text-gray-900">ì‹¤ìˆ˜ë ¹(ì„¸í›„)</div>
            <p class="text-gray-600 mt-1">ì…ë ¥í•œ ê¸ˆì•¡ì„ <b>ì‹¤ìˆ˜ë ¹ì•¡</b>ìœ¼ë¡œ ë³´ê³ , ì„¸ëª©/4ëŒ€ë³´í—˜ì„ ë°˜ì˜í•´ <b>ì§€ê¸‰ì´ì•¡</b>ì„ ì—­ì‚°í•©ë‹ˆë‹¤.</p>
          </div>
        </label>

        <label class="flex items-start gap-3 p-3 rounded-xl border cursor-pointer hover:bg-gray-50">
          <input type="radio" name="input_mode" value="gross" class="mt-1.5">
          <div class="flex-1">
            <div class="font-semibold text-gray-900">ì§€ê¸‰ì´ì•¡(ì„¸ì „)</div>
            <p class="text-gray-600 mt-1">ì…ë ¥í•œ ê¸ˆì•¡ì„ <b>ì§€ê¸‰ì´ì•¡</b>ìœ¼ë¡œ ê³ ì •í•˜ì—¬ ê³µì œë¥¼ ê³„ì‚°í•˜ê³ , <b>ì‹¤ìˆ˜ë ¹ì•¡</b>ì„ ì‚°ì¶œí•©ë‹ˆë‹¤.</p>
          </div>
        </label>
      </div>

      <div class="mt-5 flex justify-end gap-2">
        <button id="input_mode_apply" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">ì ìš©</button>
      </div>
    </div>
  </div>

  <script>
    const NF_WON = new Intl.NumberFormat('ko-KR');
    const NF_PCT = new Intl.NumberFormat('ko-KR', { minimumFractionDigits: 1, maximumFractionDigits: 1 });

    const fmt = n => NF_WON.format(Math.round(n)) + ' ì›';
    const fmtRaw = n => NF_WON.format(Math.round(n));
    const fmtPct = n => NF_PCT.format(n) + ' %';
    const trunc10 = v => Math.floor(v / 10) * 10;
    const clamp = (x, lo, hi) => Math.min(Math.max(x, lo), hi);
    const onlyNumber = v => parseFloat((v || '0').replace(/[^\d]/g, '')) || 0;
    const bindComma = el => el.addEventListener('input', e => {
      const d = e.target.value.replace(/[^\d]/g, '');
      e.target.value = d ? NF_WON.format(+d) : '';
    });

    const EL = {
      tabSingleBtn: document.getElementById('tab_single'),
      tabMultiBtn: document.getElementById('tab_multi'),
      contentSingle: document.getElementById('content_single'),
      contentMulti: document.getElementById('content_multi'),
      netInput: document.getElementById('net_pay'),
      nonTaxInput: document.getElementById('nontax'),
      primaryInputLabel: document.getElementById('primary_input_label'),
      calcBtn: document.getElementById('calc_btn'),
      statusSingle: document.getElementById('table_status'),
      statusMulti: document.getElementById('table_status_multi'),
      result: document.getElementById('result'),
      error: document.getElementById('error_message'),
      gross: document.getElementById('gross_pay_result'),
      totalDed: document.getElementById('deductions_total_result'),
      annualExcl: document.getElementById('annual_excl'),
      annualIncl: document.getElementById('annual_incl'),
      tbExcl: document.getElementById('total_burden_excl'),
      tbIncl: document.getElementById('total_burden_incl'),
      tbExclPct: document.getElementById('total_burden_excl_pct'),
      tbInclPct: document.getElementById('total_burden_incl_pct'),
      socialSum: document.getElementById('social_total_summary'),
      withholdSum: document.getElementById('withholding_total_summary'),
      overheadExcl: document.getElementById('overhead_excl_gratuity'),
      gratuity: document.getElementById('gratuity_summary'),
      overheadIncl: document.getElementById('overhead_incl_gratuity'),
      np: document.getElementById('np_deduction'),
      hi: document.getElementById('hi_deduction'),
      ltc: document.getElementById('ltc_deduction'),
      ei: document.getElementById('ei_deduction'),
      tax: document.getElementById('tax_deduction'),
      ltax: document.getElementById('local_tax_deduction'),
      np_er: document.getElementById('np_er'),
      hi_er: document.getElementById('hi_er'),
      ltc_er: document.getElementById('ltc_er'),
      ei_er: document.getElementById('ei_er'),
      wci_er: document.getElementById('wci_er'),
      er_total: document.getElementById('er_total'),
      baseIns: document.getElementById('base_ins'),
      baseNP: document.getElementById('base_np'),
      baseHI: document.getElementById('base_hi'),
      baseEI: document.getElementById('base_ei'),
      baseTax: document.getElementById('base_tax'),
      annualToggle: document.getElementById('annual_toggle'),
      annualWrap: document.getElementById('annual_wrapper'),
      annualBody: document.getElementById('annual_tax_detail'),
      annualTable: document.getElementById('annual_table'),
      verBtn: document.getElementById('ver_btn'),
      verModal: document.getElementById('ver_modal'),
      verClose: document.getElementById('ver_close'),
      verOk: document.getElementById('ver_ok'),
      npMinLabel: document.getElementById('np_min_label'),
      npMaxLabel: document.getElementById('np_max_label'),
      hiMinLabel: document.getElementById('hi_min_label'),
      hiMaxLabel: document.getElementById('hi_max_label'),
      taxZeroLabel: document.getElementById('tax_zero_label'),
      inputModeBtn: document.getElementById('input_mode_open'),
      inputModeModal: document.getElementById('input_mode_modal'),
      inputModeClose: document.getElementById('input_mode_close'),
      inputModeApply: document.getElementById('input_mode_apply'),
      inputModeLabel: document.getElementById('input_mode_label'),
      multiInputs: document.getElementById('multi_inputs'),
      multiResults: document.getElementById('multi_results'),
      addRow: document.getElementById('add_row'),
      resetMulti: document.getElementById('reset_multi'),
      calcMulti: document.getElementById('calc_multi'),
      thMultiCol1: document.getElementById('th_multi_col1'),
      multiHintLabel: document.getElementById('multi_hint_label'),
    };

    const ACTIVE = ['text-blue-600','font-bold','border-blue-600'];
    const INACTIVE = ['text-gray-500','border-transparent'];
    const setActive = (a,b,show,hide) => {
      a.classList.add(...ACTIVE); a.classList.remove(...INACTIVE);
      b.classList.add(...INACTIVE); b.classList.remove(...ACTIVE);
      show.classList.remove('hidden'); hide.classList.add('hidden');
    };
    EL.tabSingleBtn.addEventListener('click', ()=>setActive(EL.tabSingleBtn, EL.tabMultiBtn, EL.contentSingle, EL.contentMulti));
    EL.tabMultiBtn.addEventListener('click',  ()=>setActive(EL.tabMultiBtn, EL.tabSingleBtn, EL.contentMulti, EL.contentSingle));
    setActive(EL.tabSingleBtn, EL.tabMultiBtn, EL.contentSingle, EL.contentMulti);

    const NP_MIN=400_000, NP_MAX=6_370_000;
    const HI_MIN=279_266, HI_MAX=127_056_982;
    const NP_RATE=0.0450, HI_RATE=0.03545, LTC_RATE=0.1295, EI_RATE=0.0090;
    const NP_ER_RATE=0.0450, HI_ER_RATE=0.03545, LTC_ER_RATE=0.1295, EI_ER_RATE=0.0115, WCI_ER_RATE=0.0072;
    const BASE10_1PERSON_RAW=1_507_405;
    const TAX_ZERO_THRESHOLD = 1_060_000;
    const EARNED_DED_CAP = 20_000_000;
    const BASIC_DEDUCTION = 1_500_000;

    bindComma(EL.netInput);
    bindComma(EL.nonTaxInput);
    const num = el => onlyNumber(el.value);

    function fillVerModalBounds(){
      EL.npMinLabel.textContent = fmt(NP_MIN);
      EL.npMaxLabel.textContent = fmt(NP_MAX);
      EL.hiMinLabel.textContent = fmt(HI_MIN);
      EL.hiMaxLabel.textContent = fmt(HI_MAX);
      EL.taxZeroLabel.textContent = fmt(TAX_ZERO_THRESHOLD);
    }
    function openVerModal(){ fillVerModalBounds(); EL.verModal.classList.remove('hidden'); EL.verModal.classList.add('flex'); document.body.classList.add('overflow-hidden'); }
    function closeVerModal(){ EL.verModal.classList.add('hidden'); EL.verModal.classList.remove('flex'); document.body.classList.remove('overflow-hidden'); }
    EL.verBtn.addEventListener('click', openVerModal);
    EL.verClose.addEventListener('click', closeVerModal);
    EL.verOk.addEventListener('click', closeVerModal);
    EL.verModal.addEventListener('click', (e)=>{ const dialog=EL.verModal.querySelector('[role="dialog"]'); if(!dialog.contains(e.target)) closeVerModal(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeVerModal(); });

    let inputMode = 'net'; // 'net' | 'gross'
    function openInputMode(){ EL.inputModeModal.classList.add('show'); document.body.classList.add('overflow-hidden'); setInputModeRadios(inputMode); }
    function closeInputMode(){ EL.inputModeModal.classList.remove('show'); document.body.classList.remove('overflow-hidden'); }
    EL.inputModeBtn.addEventListener('click', openInputMode);
    EL.inputModeClose.addEventListener('click', closeInputMode);
    EL.inputModeModal.addEventListener('click', (e)=>{ const dialog=EL.inputModeModal.querySelector('[role="dialog"]'); if(dialog && !dialog.contains(e.target)) closeInputMode(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeInputMode(); });

    function setInputModeRadios(mode){
      const rNet=document.querySelector('input[name="input_mode"][value="net"]');
      const rGross=document.querySelector('input[name="input_mode"][value="gross"]');
      if(!rNet || !rGross) return;
      rNet.checked = (mode==='net');
      rGross.checked = (mode==='gross');
    }

    // ğŸ”§ ê¸°ì¡´ í–‰ë“¤ì˜ placeholderë„ ì¦‰ì‹œ ë™ê¸°í™”
    function updateMultiPlaceholders(){
      const ph = (inputMode==='net' ? 'ì‹¤ìˆ˜ë ¹ì•¡' : 'ì§€ê¸‰ì´ì•¡');
      document.querySelectorAll('#multi_inputs .net-input').forEach(inp=>{
        inp.setAttribute('placeholder', ph);
      });
    }

    function applyInputModeUI(){
      if(inputMode==='net'){
        EL.inputModeLabel.textContent = 'ì‹¤ìˆ˜ë ¹';
        EL.primaryInputLabel.textContent = 'ì‹¤ìˆ˜ë ¹ì•¡ (ì›)';
        EL.netInput.placeholder = 'ì˜ˆ: 11,350,000';
      }else{
        EL.inputModeLabel.textContent = 'ì§€ê¸‰ì´ì•¡';
        EL.primaryInputLabel.textContent = 'ì§€ê¸‰ì´ì•¡ (ì›)';
        EL.netInput.placeholder = 'ì˜ˆ: 15,000,000';
      }
      EL.thMultiCol1.textContent = 'ì‹¤ìˆ˜ë ¹ì•¡'; // ê²°ê³¼í‘œ 1ì—´ì€ ê³ ì •
      updateMultiPlaceholders();               // âœ… ì…ë ¥ì¹¸ placeholder ì¦‰ì‹œ ë°˜ì˜
    }

    EL.inputModeApply.addEventListener('click', ()=>{
      const selected = document.querySelector('input[name="input_mode"]:checked')?.value || 'net';
      inputMode = selected;
      applyInputModeUI();
      closeInputMode();
    });

    let TAX_TABLE=[], tableReady=false;
    async function loadTax(){
      const tryFetch = async (path) => {
        const r = await fetch(path, { cache:'no-store' });
        if(!r.ok) throw new Error('HTTP '+r.status);
        return r.json();
      };
      try{
        try { TAX_TABLE = await tryFetch('./simplified_tax_table_2024_1person.v2.json'); }
        catch { TAX_TABLE = await tryFetch('./simplified_tax_table_2024_1person.json'); }
        TAX_TABLE.sort((a,b)=>a.min_won-b.min_won);
        tableReady = true;
        EL.statusSingle.textContent = 'ì„¸ì•¡í‘œ ë¡œë“œ ì™„ë£Œ';
        EL.statusMulti.textContent = 'ì„¸ì•¡í‘œ ì¤€ë¹„ ìƒíƒœ: ë¡œë“œ ì™„ë£Œ';
        EL.calcBtn.disabled = false;
      }catch(e){
        EL.statusSingle.textContent = 'ì„¸ì•¡í‘œ ë¡œë“œ ì‹¤íŒ¨: '+e.message;
        EL.statusMulti.textContent = 'ì„¸ì•¡í‘œ ë¡œë“œ ì‹¤íŒ¨: '+e.message;
      }
    }
    loadTax();

    function lookupTable(x){
      let lo=0, hi=TAX_TABLE.length-1;
      while(lo<=hi){
        const m=(lo+hi)>>1, row=TAX_TABLE[m];
        if(x<row.min_won) hi=m-1;
        else if(x>=row.max_won) lo=m+1;
        else return { found:true, tax:+row.tax||0 };
      }
      return { found:false, tax:0 };
    }
    function simplifiedTax(amountExclNT){
      const r=lookupTable(amountExclNT);
      if(r.found) return trunc10(r.tax);
      const g=amountExclNT, b10=BASE10_1PERSON_RAW;
      let t=b10;
      if(g>10_000_000&&g<=14_000_000) t += 25_000 + 0.35*0.98*(g-10_000_000);
      else if(g>14_000_000&&g<=28_000_000) t += 1_397_000 + 0.38*0.98*(g-14_000_000);
      else if(g>28_000_000&&g<=30_000_000) t += 6_610_600 + 0.40*0.98*(g-28_000_000);
      else if(g>30_000_000&&g<=45_000_000) t += 7_394_600 + 0.40*(g-30_000_000);
      else if(g>45_000_000&&g<=87_000_000) t += 13_394_600 + 0.42*(g-45_000_000);
      else if(g>87_000_000)               t += 31_034_600 + 0.45*(g-87_000_000);
      return trunc10(t);
    }
    function incomeTaxProgressive(taxBase){
      const tb = Math.max(0, Math.floor(taxBase));
      let tax=0, rate=0;
      if (tb <= 14_000_000){ rate=0.06; tax = tb * 0.06; }
      else if (tb <= 50_000_000){ rate=0.15; tax = tb * 0.15 - 1_260_000; }
      else if (tb <= 88_000_000){ rate=0.24; tax = tb * 0.24 - 5_760_000; }
      else if (tb <= 150_000_000){ rate=0.35; tax = tb * 0.35 - 15_440_000; }
      else if (tb <= 300_000_000){ rate=0.38; tax = tb * 0.38 - 19_940_000; }
      else if (tb <= 500_000_000){ rate=0.40; tax = tb * 0.40 - 25_940_000; }
      else if (tb <= 1_000_000_000){ rate=0.42; tax = tb * 0.42 - 35_940_000; }
      else { rate=0.45; tax = tb * 0.45 - 65_940_000; }
      return { tax: Math.floor(tax), topRate: rate };
    }
    function earnedIncomeDeduction(totalSalaryAnnual){
      const x = totalSalaryAnnual;
      let d=0;
      if (x <= 5_000_000) d = x * 0.70;
      else if (x <= 15_000_000) d = 3_500_000 + (x - 5_000_000) * 0.40;
      else if (x <= 45_000_000) d = 7_500_000 + (x - 15_000_000) * 0.15;
      else if (x <= 100_000_000) d = 12_000_000 + (x - 45_000_000) * 0.05;
      else d = 14_750_000 + (x - 100_000_000) * 0.02;
      return Math.min(Math.floor(d), EARNED_DED_CAP);
    }
    function earnedIncomeTaxCredit(annualSalary, computedIncomeTax){
      let credit = (computedIncomeTax <= 1_300_000)
        ? Math.floor(computedIncomeTax * 0.55)
        : Math.floor(715_000 + (computedIncomeTax - 1_300_000) * 0.30);
      let cap = 0;
      if (annualSalary <= 33_000_000) cap = 740_000;
      else if (annualSalary <= 70_000_000) cap = Math.max(660_000, 740_000 - (annualSalary - 33_000_000) * 0.008);
      else if (annualSalary <= 120_000_000) cap = Math.max(500_000, 660_000 - (annualSalary - 70_000_000) * 0.5);
      else cap = Math.max(200_000, 500_000 - (annualSalary - 120_000_000) * 0.5);
      return Math.min(credit, Math.floor(cap));
    }

    function baseFromGross(gross, nonTax){
      const baseIns = Math.max(gross - nonTax, 0);
      const baseNP = clamp(Math.floor(baseIns/1000)*1000, NP_MIN, NP_MAX);
      const baseHI = clamp(baseIns, HI_MIN, HI_MAX);
      const baseEI = baseIns;
      return { baseIns, baseNP, baseHI, baseEI, baseTax: baseIns };
    }
    function employeeDeductions(bases){
      const np  = trunc10(bases.baseNP * NP_RATE);
      const hi  = trunc10(bases.baseHI * HI_RATE);
      const ltc = trunc10(hi * LTC_RATE);
      const ei  = trunc10(bases.baseEI * EI_RATE);
      const tax = bases.baseIns < TAX_ZERO_THRESHOLD ? 0 : simplifiedTax(bases.baseIns);
      const ltax= bases.baseIns < TAX_ZERO_THRESHOLD ? 0 : trunc10(tax * 0.1);
      const total = np + hi + ltc + ei + tax + ltax;
      return { np, hi, ltc, ei, tax, ltax, total };
    }
    function employerDeductions(bases){
      const np_er  = trunc10(bases.baseNP * NP_ER_RATE);
      const hi_er  = trunc10(bases.baseHI * HI_ER_RATE);
      const ltc_er = trunc10(hi_er * LTC_ER_RATE);
      const ei_er  = trunc10(bases.baseEI * EI_ER_RATE);
      const wci_er = trunc10(bases.baseEI * WCI_ER_RATE);
      const er_total = np_er + hi_er + ltc_er + ei_er + wci_er;
      return { np_er, hi_er, ltc_er, ei_er, wci_er, er_total };
    }

    function compute(netPay, nonTax){
      if(!tableReady || netPay<=0) return null;
      const approxRate = NP_RATE + HI_RATE + (HI_RATE * LTC_RATE) + EI_RATE;
      let gross = netPay / (1 - approxRate);
      const TOL = 1, MAX_IT = 60;
      for(let i=0;i<MAX_IT;i++){
        const bases = baseFromGross(gross, nonTax);
        const emp = employeeDeductions(bases);
        const newGross = netPay + emp.total;
        if (Math.abs(newGross - gross) < TOL) { gross = newGross; break; }
        gross = newGross;
      }
      return computeFromGross(gross, nonTax, netPay);
    }

    function computeFromGross(gross, nonTax, knownNet=null){
      if(gross<=0) return null;
      const bases = baseFromGross(gross, nonTax);
      const emp = employeeDeductions(bases);
      const er  = employerDeductions(bases);
      const net = (knownNet!=null) ? knownNet : Math.max(0, Math.round(gross - emp.total));
      const social_total = (emp.np + emp.hi + emp.ltc + emp.ei) + er.er_total;
      const withholding_total = emp.tax + emp.ltax;
      const gratuity = Math.round(gross / 12);
      const overhead_excl = social_total + withholding_total;
      const overhead_incl = overhead_excl + gratuity;
      const total_burden_excl = net + overhead_excl;
      const total_burden_incl = net + overhead_incl;
      const annual_excl = Math.round(gross * 12);
      const annual_incl = Math.round(gross * 13);
      return {
        net, gross, total: emp.total, annual_excl, annual_incl,
        social_total, withholding_total, overhead_excl, overhead_incl, gratuity,
        total_burden_excl, total_burden_incl,
        ...emp, ...er, ...bases, nonTax
      };
    }

    const SUMMARY_KEYS = new Set([
      'ì´ê¸‰ì—¬', 'ê³¼ì„¸í‘œì¤€', 'ì‚°ì¶œì„¸ì•¡', 'ê²°ì •ì„¸ì•¡',
      'ê¸°ë‚©ë¶€ì„¸ì•¡(ì†Œë“ì„¸)', 'ì°¨ê°ì§•ìˆ˜ì„¸ì•¡(ì†Œë“ì„¸)', 'ì°¨ê°ì§•ìˆ˜ì§€ë°©ì„¸(10%)'
    ]);
    let annualFull = false;
    let lastResult = null;

    function renderAnnual(res){
      const annualSalary = Math.max(0, Math.round((res.gross - res.nonTax) * 12));
      const earnedDed = earnedIncomeDeduction(annualSalary);
      const earnedIncomeAmt = Math.max(0, annualSalary - earnedDed);
      const taxBase = Math.max(0, earnedIncomeAmt - BASIC_DEDUCTION);
      const { tax: computedIncomeTax, topRate } = incomeTaxProgressive(taxBase);
      const eitc = earnedIncomeTaxCredit(annualSalary, computedIncomeTax);
      const stdCredit = 130_000;
      const finalIncomeTax = Math.max(0, computedIncomeTax - eitc - stdCredit);
      const prepaidIncomeTaxOnly = Math.round(lastResult.tax * 12);
      const diffIncomeTax = finalIncomeTax - prepaidIncomeTaxOnly;
      const diffLocalTax  = Math.round(diffIncomeTax * 0.10);

      const rows = [
        ['ì´ê¸‰ì—¬', annualSalary],
        ['ê·¼ë¡œì†Œë“ê³µì œ', earnedDed],
        ['ê·¼ë¡œì†Œë“ê¸ˆì•¡', earnedIncomeAmt],
        ['ê¸°ë³¸ê³µì œ', BASIC_DEDUCTION],
        ['ê³¼ì„¸í‘œì¤€', taxBase],
        ['ì„¸ìœ¨', (topRate*100).toFixed(0)+' %'],
        ['ì‚°ì¶œì„¸ì•¡', computedIncomeTax],
        ['ê·¼ë¡œì†Œë“ì„¸ì•¡ê³µì œ', eitc],
        ['í‘œì¤€ì„¸ì•¡ê³µì œ', stdCredit],
        ['ê²°ì •ì„¸ì•¡', finalIncomeTax],
        ['ê¸°ë‚©ë¶€ì„¸ì•¡(ì†Œë“ì„¸)', prepaidIncomeTaxOnly],
        ['ì°¨ê°ì§•ìˆ˜ì„¸ì•¡(ì†Œë“ì„¸)', diffIncomeTax],
        ['ì°¨ê°ì§•ìˆ˜ì§€ë°©ì„¸(10%)', diffLocalTax],
      ];

      EL.annualBody.innerHTML = '';
      const data = annualFull ? rows : rows.filter(([k])=>SUMMARY_KEYS.has(k));
      EL.annualToggle.textContent = annualFull ? 'ìš”ì•½ ë³´ê¸°' : 'ì „ì²´ ë³´ê¸°';
      EL.annualToggle.setAttribute('aria-pressed', String(annualFull));
      EL.annualWrap.classList.remove('scrollbox');

      data.forEach(([k, v])=>{
        const isRate = k==='ì„¸ìœ¨';
        const isFinal = (k==='ì°¨ê°ì§•ìˆ˜ì„¸ì•¡(ì†Œë“ì„¸)' || k==='ì°¨ê°ì§•ìˆ˜ì§€ë°©ì„¸(10%)');
        const isEmph  = (k === 'ê·¼ë¡œì†Œë“ê¸ˆì•¡' || k === 'ê²°ì •ì„¸ì•¡');
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td class="p-1.5 sm:p-2 border-b text-left ${(isRate || isFinal || isEmph) ? 'tone font-semibold' : ''}">${k}</td>
          <td class="p-1.5 sm:p-2 border-b text-right num tnum ${(isRate || isFinal || isEmph) ? 'tone font-bold' : ''}">
            <span class="nowrap">${isRate ? v : NF_WON.format(v) + ' ì›'}</span>
          </td>`;
        EL.annualBody.appendChild(tr);
      });

      return { earnedIncomeAmt, finalIncomeTax, topRate };
    }

    EL.calcBtn.addEventListener('click', ()=>{
      if(!tableReady){ EL.statusSingle.textContent='ì„¸ì•¡í‘œê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'; return; }
      const primary = num(EL.netInput), nonTax=num(EL.nonTaxInput);
      if(primary<=0){
        EL.result.classList.add('hidden');
        EL.error.classList.remove('hidden');
        return;
      }

      let r = null;
      if(inputMode==='net'){
        r = compute(primary, nonTax);
      }else{
        r = computeFromGross(primary, nonTax, null);
      }
      if(!r) return;
      lastResult = r;

      const baseNet = r.net;
      const exclPct = (r.total_burden_excl / Math.max(1, baseNet)) * 100;
      const inclPct = (r.total_burden_incl / Math.max(1, baseNet)) * 100;

      EL.socialSum.textContent = fmt(r.social_total);
      EL.withholdSum.textContent = fmt(r.withholding_total);
      EL.overheadExcl.textContent = fmt(r.overhead_excl);
      EL.gratuity.textContent = fmt(r.gratuity);
      EL.overheadIncl.textContent = fmt(r.overhead_incl);

      EL.tbExcl.textContent = fmt(r.total_burden_excl);
      EL.tbIncl.textContent = fmt(r.total_burden_incl);
      EL.tbExclPct.textContent = fmtPct(exclPct);
      EL.tbInclPct.textContent = fmtPct(inclPct);

      EL.annualExcl.textContent = fmt(r.annual_excl);
      EL.annualIncl.textContent = fmt(r.annual_incl);
      EL.gross.textContent = fmt(r.gross);
      EL.totalDed.textContent = fmt(r.total);

      EL.np.textContent = fmt(r.np);
      EL.hi.textContent = fmt(r.hi);
      EL.ltc.textContent = fmt(r.ltc);
      EL.ei.textContent = fmt(r.ei);
      EL.tax.textContent = fmt(r.tax);
      EL.ltax.textContent = fmt(r.ltax);

      EL.np_er.textContent = fmt(r.np_er);
      EL.hi_er.textContent = fmt(r.hi_er);
      EL.ltc_er.textContent = fmt(r.ltc_er);
      EL.ei_er.textContent = fmt(r.ei_er);
      EL.wci_er.textContent = fmt(r.wci_er);
      EL.er_total.textContent = fmt(r.er_total);

      EL.baseIns.textContent = fmt(r.baseIns);
      EL.baseNP.textContent  = fmt(r.baseNP);
      EL.baseHI.textContent  = fmt(r.baseHI);
      EL.baseEI.textContent  = fmt(r.baseEI);
      EL.baseTax.textContent = fmt(r.baseTax);

      annualFull = false;
      renderAnnual(r);

      EL.error.classList.add('hidden');
      EL.result.classList.remove('hidden');
    });

    EL.annualToggle?.addEventListener('click', () => {
      annualFull = !annualFull;
      if (lastResult) renderAnnual(lastResult);
    });

    function createRow(initialPrimary='', initialNT=''){
      const row = document.createElement('div');
      row.className='flex flex-col sm:flex-row gap-2';
      const placeholder = (inputMode==='net' ? 'ì‹¤ìˆ˜ë ¹ì•¡' : 'ì§€ê¸‰ì´ì•¡');
      row.innerHTML = `
        <input type="text" inputmode="numeric" placeholder="${placeholder}" class="net-input w-full sm:w-64 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="${initialPrimary}">
        <input type="text" inputmode="numeric" placeholder="ë¹„ê³¼ì„¸ í•©ê³„(ì—†ìœ¼ë©´ 0)" class="nontax-input w-full sm:w-64 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value="${initialNT}">
        <button type="button" class="remove-row px-3 py-2 text-sm rounded-lg border hover:bg-gray-100">ì‚­ì œ</button>
      `;
      EL.multiInputs.appendChild(row);
      const netEl=row.querySelector('.net-input'), ntEl=row.querySelector('.nontax-input');
      bindComma(netEl); bindComma(ntEl);
      row.querySelector('.remove-row').addEventListener('click', ()=>row.remove());
    }

    function calcMulti(){
      if(!tableReady){ EL.statusMulti.textContent='ì„¸ì•¡í‘œê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'; return; }
      EL.multiResults.innerHTML='';

      const rows = Array.from(EL.multiInputs.children);
      if(!rows.length) createRow();

      rows.forEach(r=>{
        const primary = onlyNumber(r.querySelector('.net-input').value);
        const nonTax  = onlyNumber(r.querySelector('.nontax-input').value);
        if(primary<=0) return;

        const res = (inputMode==='net') ? compute(primary, nonTax) : computeFromGross(primary, nonTax);
        if(!res) return;

        const annualSalary = Math.max(0, Math.round((res.gross - nonTax) * 12));
        const earnedDed = earnedIncomeDeduction(annualSalary);
        const earnedIncomeAmt = Math.max(0, annualSalary - earnedDed);
        const taxBase = Math.max(0, earnedIncomeAmt - BASIC_DEDUCTION);
        const { topRate, tax: computedIncomeTax } = incomeTaxProgressive(taxBase);
        const eitc = earnedIncomeTaxCredit(annualSalary, computedIncomeTax);
        const stdCredit = 130_000;
        const finalIncomeTax = Math.max(0, computedIncomeTax - eitc - stdCredit);

        const baseNet = res.net;
        const exclPct = (res.total_burden_excl/Math.max(1, baseNet))*100;
        const inclPct = (res.total_burden_incl/Math.max(1, baseNet))*100;

        const tr = document.createElement('tr'); tr.className='border-t';
        tr.innerHTML = `
          <td class="p-2 whitespace-nowrap text-right">${fmt(res.net)}</td>
          <td class="p-2 whitespace-nowrap text-right">${fmt(nonTax)}</td>
          <td class="p-2 whitespace-nowrap text-right">${fmt(res.gross)}</td>
          <td class="p-2 whitespace-nowrap text-right">${fmt(res.total)}</td>
          <td class="p-2 whitespace-nowrap text-right">${fmt(Math.round(res.gross*12))}</td>
          <td class="p-2 whitespace-nowrap text-right">${fmt(Math.round(res.gross*13))}</td>
          <td class="p-2 whitespace-nowrap text-right">${fmt(res.total_burden_excl)}</td>
          <td class="p-2 whitespace-nowrap text-right">${fmtPct(exclPct)}</td>
          <td class="p-2 whitespace-nowrap text-right">${fmt(res.total_burden_incl)}</td>
          <td class="p-2 whitespace-nowrap text-right">${fmtPct(inclPct)}</td>
          <td class="p-2 whitespace-nowrap text-right">${fmt(earnedIncomeAmt)}</td>
          <td class="p-2 whitespace-nowrap text-right tnum">${(topRate*100).toFixed(0)} %</td>
          <td class="p-2 whitespace-nowrap text-right">${fmt(finalIncomeTax)}</td>`;
        EL.multiResults.appendChild(tr);
      });

      if(!EL.multiResults.children.length){
        const tr=document.createElement('tr');
        tr.innerHTML=`<td colspan="13" class="p-3 text-center text-gray-500 whitespace-nowrap">ìœ íš¨í•œ ì…ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</td>`;
        EL.multiResults.appendChild(tr);
      }
    }

    // ğŸ¯ ì´ˆê¸°í™” ê¸°ëŠ¥: ì…ë ¥ í–‰/ê²°ê³¼ ëª¨ë‘ ë¦¬ì…‹í•˜ê³  ê¸°ë³¸ ë‘ í–‰ ìƒì„±
    function resetMulti(){
      EL.multiInputs.innerHTML = '';
      EL.multiResults.innerHTML = '';
      createRow(); createRow();
      updateMultiPlaceholders();
    }

    EL.addRow.addEventListener('click', ()=>createRow());
    EL.resetMulti.addEventListener('click', resetMulti);
    EL.calcMulti.addEventListener('click', calcMulti);

    // ì´ˆê¸° í–‰
    createRow(); createRow();

    // ì´ˆê¸° UI ë™ê¸°í™”
    applyInputModeUI();
  </script>
</body>
</html>
