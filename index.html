<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>네트급여 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family:'Inter','Noto Sans KR',sans-serif; background:#f3f4f6 }
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:1rem;}
    .tone{background:#fef9c3}
    .tnum{font-variant-numeric:tabular-nums;font-feature-settings:"tnum";}
    .nowrap{white-space:nowrap;}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:50}
    .modal.show{display:flex}
  </style>
</head>
<body class="p-4 sm:p-6 flex items-center justify-center min-h-screen">

<main class="w-full max-w-[1280px]">
  <section class="card p-5 mb-4">
    <h1 class="text-2xl font-extrabold text-gray-900">네트급여 계산기 (Ver 2.0)</h1>
  </section>

  <section class="card p-6">
    <!-- 대표자 세율 입력 -->
    <div class="mb-4">
      <label for="owner_rate" class="block text-gray-700 font-semibold mb-2">대표자 소득세율(%)</label>
      <div class="flex flex-col sm:flex-row sm:items-center gap-2">
        <div class="flex items-center gap-2">
          <input id="owner_rate" type="text" inputmode="decimal"
            class="w-32 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-right tnum" value="35">
          <span class="text-sm text-gray-600">%</span>
        </div>
        <div class="text-sm text-gray-600">
          합계 세율:
          <b id="combined_rate" class="text-gray-900 tnum">- %</b>
          <span id="combined_hint" class="text-[11px] text-gray-500 ml-1"></span>
        </div>
      </div>
    </div>

    <!-- 입력행 -->
    <div id="multi_inputs" class="space-y-2 mb-3"></div>

    <!-- 버튼 -->
    <div class="flex gap-2 mb-3">
      <button id="add_row" class="px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700">+ 행 추가</button>
      <button id="reset_multi" class="px-3 py-2 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">초기화</button>
      <button id="calc_multi" class="px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700">다중 계산</button>
    </div>

    <!-- 결과표 -->
    <div class="overflow-x-auto">
      <table class="w-full text-sm border border-gray-200 rounded-lg overflow-hidden min-w-[1650px]">
        <thead class="bg-gray-50 text-gray-700">
          <tr>
            <th class="p-2 border-b text-right">실수령액</th>
            <th class="p-2 border-b text-right">비과세</th>
            <th class="p-2 border-b text-right">지급총액</th>
            <th class="p-2 border-b text-right">공제합계</th>
            <th class="p-2 border-b text-right">연봉(퇴직금제외)</th>
            <th class="p-2 border-b text-right">연봉(퇴직금포함)</th>
            <th class="p-2 border-b text-right">총부담(퇴직금제외)</th>
            <th class="p-2 border-b text-right">총부담%(제외)</th>
            <th class="p-2 border-b text-right">총부담(퇴직금포함)</th>
            <th class="p-2 border-b text-right">총부담%(포함)</th>
            <th class="p-2 border-b text-right">근로소득금액</th>
            <th class="p-2 border-b text-right">세율구간</th>
            <th class="p-2 border-b text-right">결정세액</th>
            <th class="p-2 border-b text-right">실부담액(퇴직금제외)</th>
            <th class="p-2 border-b text-right">실부담액(퇴직금포함)</th>
          </tr>
        </thead>
        <tbody id="multi_results" class="text-gray-800"></tbody>
      </table>
    </div>
  </section>

  <section class="card p-4 text-center mt-4 text-xs text-gray-500">
    © 2024 한국병의원데이터. All Rights Reserved
  </section>
</main>

<script>
const NF_WON = new Intl.NumberFormat('ko-KR');
const NF_PCT = new Intl.NumberFormat('ko-KR',{minimumFractionDigits:1,maximumFractionDigits:1});
const fmt = n => NF_WON.format(Math.round(n))+' 원';
const fmtPct = n => NF_PCT.format(n)+' %';
const onlyNumber = v => parseFloat((v||'0').replace(/[^\d.]/g,''))||0;
const bindComma = el => el.addEventListener('input',e=>{
  const d=e.target.value.replace(/[^\d]/g,'');
  e.target.value=d?NF_WON.format(+d):'';
});

// 제도 파라미터
const HI_RATE=0.03545, LTC_RATE=0.1295;
const HEALTH_TOTAL_RATE = 2 * HI_RATE * (1 + LTC_RATE); // ≈ 0.08008 (근로자+사업주)
const NP_RATE=0.045, EI_RATE=0.009;

// 대표자 세율 계산
const EL={
  ownerRateInput:document.getElementById('owner_rate'),
  combinedRateOut:document.getElementById('combined_rate'),
  combinedHint:document.getElementById('combined_hint'),
  multiInputs:document.getElementById('multi_inputs'),
  addRow:document.getElementById('add_row'),
  resetMulti:document.getElementById('reset_multi'),
  calcMulti:document.getElementById('calc_multi'),
  multiResults:document.getElementById('multi_results'),
};

function parseOwnerRatePct(){return onlyNumber(EL.ownerRateInput.value);}
function calcCombinedRateFraction(){
  const owner= parseOwnerRatePct()/100;
  const local= owner*0.10;
  return owner+local+HEALTH_TOTAL_RATE;
}
function renderCombinedRate(){
  const owner=parseOwnerRatePct()/100;
  const local=owner*0.10;
  const total=owner+local+HEALTH_TOTAL_RATE;
  EL.combinedRateOut.textContent=fmtPct(total*100);
  EL.combinedHint.textContent=`(소득세 ${fmtPct(owner*100)} + 지방 ${fmtPct(local*100)} + 건보·장기요양 ${fmtPct(HEALTH_TOTAL_RATE*100)})`;
}
EL.ownerRateInput.addEventListener('input',renderCombinedRate);
renderCombinedRate();

// 간단 모의 계산 (예시용: 실제 세액표는 생략)
function computeFromGross(gross,nonTax){
  const base=gross-nonTax;
  const np=base*NP_RATE, hi=base*HI_RATE, ltc=hi*LTC_RATE, ei=base*EI_RATE;
  const empTotal=np+hi+ltc+ei+base*0.1; // 단순 공제합계 예시
  const net=gross-empTotal;
  const annual=gross*12, annual13=gross*13;
  const totalBurdenExcl=net+empTotal;
  const totalBurdenIncl=totalBurdenExcl+gross/12;
  return{net,gross,total:empTotal,annual_excl:annual,annual_incl:annual13,
         total_burden_excl:totalBurdenExcl,total_burden_incl:totalBurdenIncl};
}

// 행 추가/초기화
function createRow(){
  const row=document.createElement('div');
  row.className='flex flex-col sm:flex-row gap-2';
  row.innerHTML=`
    <input type="text" inputmode="numeric" placeholder="실수령액" class="net-input w-full sm:w-64 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
    <input type="text" inputmode="numeric" placeholder="비과세(없으면0)" class="nontax-input w-full sm:w-64 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
    <button type="button" class="remove-row px-3 py-2 text-sm rounded-lg border hover:bg-gray-100">삭제</button>`;
  EL.multiInputs.appendChild(row);
  const n1=row.querySelector('.net-input'), n2=row.querySelector('.nontax-input');
  bindComma(n1);bindComma(n2);
  row.querySelector('.remove-row').addEventListener('click',()=>row.remove());
}
function resetMulti(){EL.multiInputs.innerHTML='';EL.multiResults.innerHTML='';createRow();createRow();}
EL.addRow.addEventListener('click',createRow);
EL.resetMulti.addEventListener('click',resetMulti);
resetMulti();

// 다중 계산
function calcMulti(){
  EL.multiResults.innerHTML='';
  const combinedRate=calcCombinedRateFraction();
  const rows=Array.from(EL.multiInputs.children);
  rows.forEach(r=>{
    const primary=onlyNumber(r.querySelector('.net-input').value);
    const nonTax=onlyNumber(r.querySelector('.nontax-input').value);
    if(primary<=0)return;
    const res=computeFromGross(primary,nonTax);
    const exclPct=(res.total_burden_excl/res.net)*100;
    const inclPct=(res.total_burden_incl/res.net)*100;
    const earnedIncomeAmt=res.annual_excl*0.8;
    const topRate=35;
    const finalIncomeTax=res.gross*0.05;
    const realExcl=Math.round(res.total_burden_excl*(1-combinedRate));
    const realIncl=Math.round(res.total_burden_incl*(1-combinedRate));
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="p-2 text-right">${fmt(res.net)}</td>
      <td class="p-2 text-right">${fmt(nonTax)}</td>
      <td class="p-2 text-right">${fmt(res.gross)}</td>
      <td class="p-2 text-right">${fmt(res.total)}</td>
      <td class="p-2 text-right">${fmt(res.annual_excl)}</td>
      <td class="p-2 text-right">${fmt(res.annual_incl)}</td>
      <td class="p-2 text-right">${fmt(res.total_burden_excl)}</td>
      <td class="p-2 text-right">${fmtPct(exclPct)}</td>
      <td class="p-2 text-right">${fmt(res.total_burden_incl)}</td>
      <td class="p-2 text-right">${fmtPct(inclPct)}</td>
      <td class="p-2 text-right">${fmt(earnedIncomeAmt)}</td>
      <td class="p-2 text-right">${topRate} %</td>
      <td class="p-2 text-right">${fmt(finalIncomeTax)}</td>
      <td class="p-2 text-right">${fmt(realExcl)}</td>
      <td class="p-2 text-right">${fmt(realIncl)}</td>`;
    EL.multiResults.appendChild(tr);
  });
  if(!EL.multiResults.children.length)
    EL.multiResults.innerHTML='<tr><td colspan="15" class="p-3 text-center text-gray-500">유효한 입력이 없습니다.</td></tr>';
}
EL.calcMulti.addEventListener('click',calcMulti);
</script>
</body>
</html>
